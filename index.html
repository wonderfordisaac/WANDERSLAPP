<!DOCTYPE html>
<html lang="ny">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>WANDERSLAPP S & R MONAY</title>
    <style>
    link<play>monaytag.con()
        }
        https://otieu.com/4/9442710;
        }
    </play>
        /* Global styles */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: #f0f2f5;
            color: #333;
        }
        header {
            background-color: #005f73;
            color: white;
            padding: 1rem;
            text-align: center;
            font-size: 1.5rem;
            font-weight: bold;
        }
        main {
            max-width: 480px;
            margin: 2rem auto;
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        h2 {
            text-align: center;
            margin-bottom: 1rem;
            color: #0077b6;
        }
        form {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }
        label {
            font-weight: 600;
        }
        input[type="text"],
        input[type="password"],
        input[type="tel"],
        input[type="number"],
        select {
            padding: 0.5rem;
            font-size: 1rem;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        button {
            background-color: #0081a7;
            color: white;
            border: none;
            padding: 0.75rem;
            font-size: 1.1rem;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.25s ease;
        }
        button:hover {
            background-color: #005f73;
        }
        /* Dashboard styles */
        #dashboard {
            display: none;
            flex-direction: column;
        }
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #00afb9;
            padding: 0.75rem 1rem;
            color: white;
            border-radius: 6px 6px 0 0;
            font-weight: bold;
        }
        #balance {
            font-size: 1.2rem;
        }
        #notificationIcon {
            position: relative;
            cursor: pointer;
        }
        #notificationIcon::after {
            content: attr(data-count);
            position: absolute;
            top: -8px;
            right: -8px;
            background: red;
            color: white;
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 50%;
            display: none;
        }
        #notificationIcon[data-count]:not([data-count="0"])::after {
            display: inline-block;
        }
        #messages {
            max-height: 150px;
            overflow-y: auto;
            background: #e0f7fa;
            border: 1px solid #00acc1;
            padding: 0.5rem;
            margin-top: 0.5rem;
            border-radius: 4px;
            display: none;
            font-size: 0.9rem;
        }
        #sendMoneySection {
            margin-top: 1rem;
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }
        #logoutBtn {
            margin-top: 1rem;
            background-color: #d90429;
        }
        /* Show error message */
        .error {
            color: #d90429;
            font-size: 0.9rem;
            font-weight: 600;
        }
    </style>
</head>
<body>

<header>WANDERSLAPP S & R MONAY</header>

<main>
    <!-- Registration form -->
    <section id="registerSection">
        <h2>Register</h2>
        <form id="registerForm" aria-label="Register form">
            <label for="firstName">Zina Loyamba</label>
            <input type="text" id="firstName" name="firstName" required autocomplete="given-name" />

            <label for="lastName">Zina Lachiwili</label>
            <input type="text" id="lastName" name="lastName" required autocomplete="family-name" />

            <label for="phoneRegister">Phone Number</label>
            <input type="tel" id="phoneRegister" name="phoneRegister" pattern="[0-9]{10,15}" placeholder="10-15 digits" required autocomplete="tel" />

            <label for="passwordRegister">Password</label>
            <input type="password" id="passwordRegister" name="passwordRegister" minlength="6" required autocomplete="new-password" />

            <button type="submit">Register</button>
            <p>Already registered? <button type="button" id="showLoginBtn">Login here</button></p>
            <p id="registerError" class="error" role="alert" aria-live="assertive"></p>
        </form>
    </section>

    <!-- Login form -->
    <section id="loginSection" style="display:none;">
        <h2>Login</h2>
        <form id="loginForm" aria-label="Login form">
            <label for="phoneLogin">Phone Number</label>
            <input type="tel" id="phoneLogin" name="phoneLogin" pattern="[0-9]{10,15}" placeholder="10-15 digits" required autocomplete="tel" />

            <label for="passwordLogin">Password</label>
            <input type="password" id="passwordLogin" name="passwordLogin" minlength="6" required autocomplete="current-password" />

            <button type="submit">Lowani</button>
            <p>New user? <button type="button" id="showRegisterBtn">Register here</button></p>
            <p id="loginError" class="error" role="alert" aria-live="assertive"></p>
        </form>
    </section>

    <!-- Dashboard -->
    <section id="dashboard" aria-live="polite">
        <div class="dashboard-header">
            <div id="balance">Balance: MK 10000.00</div>
            <div id="notificationIcon" tabindex="0" role="button" aria-label="Notifications" data-count="0">ðŸ””</div>
        </div>

        <div id="messages" aria-live="polite" aria-atomic="true"></div>

        <section id="sendMoneySection">
            <h3>Send Money</h3>
            <form id="sendMoneyForm" aria-label="Send money form">
                <label for="recipientPhone">Nambala ya munthu amene akutumizila ndalama</label>
                <input type="tel" id="recipientPhone" name="recipientPhone" pattern="[0-9]{10,15}" placeholder="10-15 digits" required autocomplete="tel" />

                <label for="amount">Ndalama zomwe akutumiza</label>
                <input type="number" id="amount" name="amount" min="1" step="0.01" required />

                <label for="accountType">Account Type</label>
                <select id="accountType" name="accountType" required>
                    <option value="user">User Account</option>
                    <option value="airtel">Airtel Money</option>
                    <option value="tnm">TNM Mpamba</option>
                    <option value="paypal">PayPal Account</option>
                </select>

                <button type="submit">Tumiza</button>
                <p id="sendMoneyError" class="error" role="alert" aria-live="assertive"></p>
                <p id="sendMoneySuccess" aria-live="polite" style="color: green;"></p>
            </form>
        </section>

        <button id="logoutBtn" aria-label="Logout">Logout</button>
    </section>
</main>

<script>
    // Simple in-memory user database
    const users = {};

    // Current logged in user phone number
    let currentUser = null;

    // Notifications store for current user
    let notifications = [];

    // Utility to update notification icon count
    function updateNotificationCount() {
        const icon = document.getElementById('notificationIcon');
        icon.setAttribute('data-count', notifications.length);
    }

    // Utility to render messages in messages panel
    function renderMessages() {
        const messagesDiv = document.getElementById('messages');
        if (notifications.length === 0) {
            messagesDiv.style.display = 'none';
            messagesDiv.innerHTML = '';
        } else {
            messagesDiv.style.display = 'block';
            messagesDiv.innerHTML = notifications.map(n =>
                `<div><strong>${n.from}:</strong> ${n.message}</div>`
            ).join('');
        }
    }

    // Show register form, hide login and dashboard
    function showRegister() {
        document.getElementById('registerSection').style.display = 'block';
        document.getElementById('loginSection').style.display = 'none';
        document.getElementById('dashboard').style.display = 'none';
        clearErrors();
    }

    // Show login form, hide register and dashboard
    function showLogin() {
        document.getElementById('registerSection').style.display = 'none';
        document.getElementById('loginSection').style.display = 'block';
        document.getElementById('dashboard').style.display = 'none';
        clearErrors();
    }

    // Show dashboard, hide register and login
    function showDashboard() {
        document.getElementById('registerSection').style.display = 'none';
        document.getElementById('loginSection').style.display = 'none';
        document.getElementById('dashboard').style.display = 'flex';
        renderDashboard();
        clearErrors();
    }

    // Clear all error messages
    function clearErrors() {
        document.getElementById('registerError').textContent = '';
        document.getElementById('loginError').textContent = '';
        document.getElementById('sendMoneyError').textContent = '';
        document.getElementById('sendMoneySuccess').textContent = '';
    }

    // Register form submit handler
    document.getElementById('registerForm').addEventListener('submit', function(e) {
        e.preventDefault();
        clearErrors();

        const firstName = this.firstName.value.trim();
        const lastName = this.lastName.value.trim();
        const phone = this.phoneRegister.value.trim();
        const password = this.passwordRegister.value;

        if (users[phone]) {
            document.getElementById('registerError').textContent = 'Phone number already registered.';
            return;
        }

        // Save user with initial balance 0
        users[phone] = {
            firstName,
            lastName,
            phone,
            password,
            balance: 10000,
            notifications: []
        };

        alert('Registration successful! Please login.');
        showLogin();
        this.reset();
    });

    // Login form submit handler
    document.getElementById('loginForm').addEventListener('submit', function(e) {
        e.preventDefault();
        clearErrors();

        const phone = this.phoneLogin.value.trim();
        const password = this.passwordLogin.value;

        if (!users[phone] || users[phone].password !== password) {
            document.getElementById('loginError').textContent = 'Invalid phone number or password.';
            return;
        }

        currentUser = phone;
        notifications = users[currentUser].notifications;
        showDashboard();
        this.reset();
    });

    // Render dashboard info
    function renderDashboard() {
        const balanceDiv = document.getElementById('balance');
        balanceDiv.textContent = `Balance: MK ${users[currentUser].balance.toFixed(2)}`;

        updateNotificationCount();
        renderMessages();
    }

    // Notification icon click toggles messages visibility
    document.getElementById('notificationIcon').addEventListener('click', () => {
        const messagesDiv = document.getElementById('messages');
        if (messagesDiv.style.display === 'block') {
            messagesDiv.style.display = 'none';
        } else {
            messagesDiv.style.display = 'block';
            // Clear notifications after reading
            notifications = [];
            users[currentUser].notifications = [];
            updateNotificationCount();
        }
    });

    // Send money form submit handler
    document.getElementById('sendMoneyForm').addEventListener('submit', function(e) {
        e.preventDefault();
        clearErrors();

        const recipientPhone = this.recipientPhone.value.trim();
        const amount = parseFloat(this.amount.value);
        const accountType = this.accountType.value;

        if (isNaN(amount) || amount <= 0) {
            document.getElementById('sendMoneyError').textContent = 'Please enter a valid amount.';
            return;
        }

        if (accountType === 'user') {
            if (!users[recipientPhone]) {
                document.getElementById('sendMoneyError').textContent = 'Recipient user not found.';
                return;
            }
            if (users[currentUser].balance < amount) {
                document.getElementById('sendMoneyError').textContent = 'Insufficient balance.';
                return;
            }
            // Deduct from sender
            users[currentUser].balance -= amount;
            // Add to recipient
            users[recipientPhone].balance += amount;
            // Add notification to recipient
            users[recipientPhone].notifications.push({
                from: users[currentUser].firstName,
                message: `Wakutumizirani MK ${amount.toFixed(2)}.`
            });
            // Update current user's dashboard
            notifications = users[currentUser].notifications;
            renderDashboard();
            document.getElementById('sendMoneySuccess').textContent = 'Money sent successfully!';
            this.reset();
        } else {
            // Simulate sending to external accounts (Airtel, TNM, PayPal)
            if (users[currentUser].balance < amount) {
                document.getElementById('sendMoneyError').textContent = 'Insufficient balance.';
                return;
            }
            users[currentUser].balance -= amount;
            renderDashboard();
            document.getElementById('sendMoneySuccess').textContent = `Money sent to ${accountType.toUpperCase()} account successfully!`;
            this.reset();
        }
    });

    // Logout button handler
    document.getElementById('logoutBtn').addEventListener('click', () => {
        currentUser = null;
        notifications = [];
        showLogin();
    });

    // Switch between register and login forms
    document.getElementById('showLoginBtn').addEventListener('click', showLogin);
    document.getElementById('showRegisterBtn').addEventListener('click', showRegister);

    // On page load show register form
    showRegister();
</script>

</body>
</html>